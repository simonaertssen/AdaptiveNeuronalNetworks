clear all; clc; close all;
tic;

%% Parameters
F = @thetaneurons;
tnow = 0; tend = 10;
h = 0.01;

pars.N = 10000;
IC = randn(pars.N, 1)*0.9 + 1;
pars.a_n = a_n(2);
pars.eta0 = 10.75; pars.delta = 0.5; pars.K = -9;
seed = 0;
pars.e = randcauchy(seed, pars.eta0, pars.delta, pars.N);

%% Builtin Matlab functionality:
[t,x] = DOPRI45(F, tnow, tend, IC, h, pars);
plot(t,x)
toc;

%% Test speed of builtin programs
tic;
f = @(t, x) thetaneurons(t, x, pars.e, pars.K/pars.N, pars.a_n);
for i = 0:pars.N
    x = DOPRIstep(f, i, 0, h);
end
toc;

%% Try speed of external c functions
tic;
coder.updateBuildInfo('addSourceFiles','DOPRIstep.c');
coder.cinclude('DOPRIstep.h');
for i = 0:100
    x = coder.ceval('DOPRIstep', f, i, 0, h); 
end
toc;
